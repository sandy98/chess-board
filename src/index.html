<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
  <title>Chess Board Web Component</title>
  <script src="/build/chessboard.js"></script>
  <style>
    .up-and-down {
      display: flex;
      flex-direction: row;
      justify-content:space-between;
      align-items: center;
      margin-top: 10px;
      margin-bottom: 10px;
      color: steelblue;
    }
  </style>

</head>
<body>
  <div
    style="display: flex; 
           padding: 1rem; 
           flex-direction: row; 
           justify-content: space-between; 
           align-items: flex-start; 
           border: solid 1px; 
           margin-top: 30px; 
           border-radius: 20px;
           height: 90%;
           min-height: 90%;
           max-height: 90%;"
  >
    <div style="width: 75%;">
      <chess-board>
        <div slot="external-contents">
          <div style="margin-bottom: 0.5rem; color:chocolate">
            ChessBoard by Domingo E. Savoretti, powered by Stencil.js
          </div>
          <div style="width: 95%;
                      display: flex; 
                      flex-direction: column; 
                      justify-content: space-evenly;
                      align-items:center;
                      border: solid 1px; 
                      border-radius: 10px;
                      padding: 0.5rem;"
          >
            <div class="up-and-down">
              <button onclick="document.querySelector('chess-board').flip()">Flip Board</button>
            </div>
            <div class="up-and-down">
              <label for="chess-sets">
                Select chess set
                &nbsp;&nbsp;&nbsp;
                <select id="chess-sets">
                </select>
              </label>
            </div>
            <div class="up-and-down">
                <label for="board-schemas">Select color schema</label>
                &nbsp;&nbsp;&nbsp;
                <select id="board-schemas">
              </select>
            </div>
            <div class="up-and-down">
              <div style="up-and-down">
                <label style="font-size: 12px">Select figure for automatic promotion</label>
              </div>
              <div style="background: beige; cursor: pointer;" onclick = "document.querySelector('chess-board').autoPromotion = 'Q'">
                <img id="img-q"/>
              </div>
              <div style="background: beige; cursor: pointer;" onclick = "document.querySelector('chess-board').autoPromotion = 'R'">
                  <img id="img-r" />
              </div>
              <div style="background: beige; cursor: pointer;" onclick = "document.querySelector('chess-board').autoPromotion = 'N'">
                  <img id="img-n" />
                </div>
                <div style="background: beige; cursor: pointer;" onclick = "document.querySelector('chess-board').autoPromotion = 'B'">
                    <img id="img-b" />
                </div>
                <div style="background: beige; cursor: pointer;">
                    <button onclick = "document.querySelector('chess-board').autoPromotion = ''">None</button>
                </div>
              </div>
            <div class="up-and-down">
              <button onclick="document.querySelector('chess-board').reset()">Reset Board</button>
              &nbsp;&nbsp;&nbsp;
              <button onclick="document.querySelector('chess-board').empty()">Empty Board</button>
            </div>
          </div>      
         </div>
        </div>
      </chess-board>  
    </div>

  <script type="text/javascript">

    const capitalize = function(word) {
      let arr = word.split('');
      arr = arr.map((ch) => ch.toLowerCase());
      arr[0] = arr[0].toUpperCase();
      return arr.join('');
    }

    const onselectchange = function(ev) {
      ev.preventDefault();
      console.log(`Set changed to ${ev.target.value}`);
      document.querySelector("chess-board").selectSet(ev.target.value);
      return true;
    }

    const onselectSchemachange = function(ev) {
      ev.preventDefault();
      //console.log(`Set changed to ${ev.target.value}`);
      document.querySelector("chess-board").setSchema(ev.target.selectedIndex);
      return true;
    }
  

    const loadselector = function() {
      console.log("Initializing chess sets selection");

      const board = document.querySelector("chess-board");
      window.board = board;

      const selectSet = document.querySelector("#chess-sets");
      for (k in board.sets) {
        let opt = document.createElement('option');
        opt.value = k;
        opt.innerHTML = capitalize(k);
        selectSet.appendChild(opt);
      }
      selectSet.value = board.chessSet;
      selectSet.onchange = onselectchange;

      const selectSchema = document.querySelector("#board-schemas");
      let i = 0
      for (k in board.schemas) {
        let opt = document.createElement('option');
        opt.value = k
        opt.innerHTML = capitalize(k);
        selectSchema.appendChild(opt);
      }
      selectSchema.selectedIndex = 1;
      selectSchema.onchange = onselectSchemachange;

      document.querySelector('#img-q').src = board.sets[board.chessSet]['Q']
      document.querySelector('#img-r').src = board.sets[board.chessSet]['R']
      document.querySelector('#img-n').src = board.sets[board.chessSet]['N']
      document.querySelector('#img-b').src = board.sets[board.chessSet]['B']

      board.setSchema(1)
    }

    document.addEventListener('load', loadselector);
    document.body.onload = loadselector;
  </script>
</body>
</html>
